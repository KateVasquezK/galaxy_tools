<tool id="ideas_genome_tracks" name="IDEAS genome tracks" version="1.0.0">
    <description></description>
    <requirements>
        <requirement type="package" version="2.4.27">bedops</requirement>
        <requirement type="package" version="1.10.4">r-data.table</requirement>
         <requirement type="package" version="1.4.4">r-optparse</requirement>
         <requirement type="package" version="332">ucsc-bedtobigbed</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
#import re
#set dbkey = None
#set sanitized_hub_name = $re.sub('\s+', '', str($hub_name), flags=re.UNICODE)
#set sanitized_long_label = str($long_label)[:79]
#set sanitized_short_label = str($short_label)[:16]
#if str($__user__.email) == 'None':
    #set email = "foo@bar.net"
#else:
    #set email = $__user__.email
#end if
#set input_dir_para = "input_dir_para"
#set input_dir_state = "input_dir_state"
mkdir $input_dir_para &&
mkdir $input_dir_state &&
mkdir '$output_trackhub.files_path' &&
#for $i in $input:
    #if $dbkey is None:
        #set dbkey = $i.metadata.dbkey
    #end if
    #set filename = $i.file_name
    #set name = $i.name
    #if $name.endswith(".para"):
        ln -s $filename $input_dir_para/$name &&
    #else if $name.endswith(".state"):
        ln -s $filename $input_dir_state/$name &&
    #end if
#end for
Rscript '$__tool_directory__/ideas_genome_tracks.R'
--build $dbkey
--chrom_len_file '$chromInfo'
--email '$email'
--galaxy_url $galaxy_url
--hub_name '$hub_name'
--input_dir_para '$input_dir_para'
--input_dir_state '$input_dir_state'
--long_label '$sanitized_long_label'
--output_trackhub '$output_trackhub'
--output_trackhub_files_path '$output_trackhub.files_path'
--output_trackhub_id '$__app__.security.encode_id($output_trackhub.id)'
#if str($set_track_color_cond.set_track_color) == "yes":
    --track_color '$set_track_color_cond.track_color'
#end if
--short_label '$sanitized_short_label']]></command>
    <inputs>
        <param name="galaxy_url" type="baseurl" value="/"/>
        <param name="input" format="txt" type="data_collection" collection_type="list" label="IDEAS files"/>
        <param name="hub_name" type="text" value="" label="Hub name" help="All white space characters will be eliminated">
            <validator type="empty_field"/>
        </param>
        <param name="short_label" type="text" value="short label" label="Short label" help="Limit to 17 characters">
            <validator type="empty_field"/>
        </param>
        <param name="long_label" type="text" value="long label" label="Long label" help="Limit to 80 characters">
            <validator type="empty_field"/>
        </param>
        <conditional name="set_track_color_cond">
            <param name="set_track_color" type="select" label="Select track color?">
                <option value="no" selected="true">No</option>
                <option value="yes">Yes</option>
            </param>
            <when value="no"/>
            <when value="yes">
                <param name="track_color" type="color" label="Track color"/>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="output_trackhub" format="trackhub"/>
    </outputs>
    <tests>
        <test>
            <param name="input">
                <collection type="list">
                    <element name="IDEAS_out.cluster" value="IDEAS_out.cluster" ftype="txt"/>
                    <element name="IDEAS_out.para" value="IDEAS_out.para" ftype="txt"/>
                    <element name="IDEAS_out.profile" value="IDEAS_out.profile" ftype="txt"/>
                    <element name="IDEAS_out.state" value="IDEAS_out.state" ftype="txt"/>
                </collection>
            </param>
            <param name="hub_name" value="MyHub"/>
            <param name="short_label" value="my short label"/>
            <param name="long_label" value="my long label"/>
            <param name="set_track_color" value="yes"/>
            <param name="track_color" value="#ff0000"/>
            <output name="output_trackhub" file="output_trackhub.html" ftype="trackhub"/>
        </test>
    </tests>
    <help>
**What it does**

-----

**Required options**

    </help>
    <citations>
        <citation type="doi">10.1093/nar/gkw278</citation>
    </citations>
</tool>